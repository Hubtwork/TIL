<center>
  <h2>
    REST API 정복하기
  </h2>
</center>

---

>[ 1. REST API ?]:(#REST-API-?)
>[ 2. REST API 의 구성과 특징 ]:(#REST-API-의-구성과-특징)
>[ 3. REST API 장단점 ]:(#REST-API-의-장단점)
>[ 4. REST API 가이드라인 ]:(#REST-API-가이드라인)



## 1. REST API ?

---

REST API 의 다양한 특징들을 알아보기 전에 관련 용어들의 의미부터 살펴보자. 

먼저 **API** 란 Applicational Programming Interface 의 약자이다. API 는 프로그램 간의 '연결고리' 라고 생각하면 된다. 위키피디아에서 검색해보면 다음과 같이 설명한다.

<span style="color:blue"><i>“API(Application Programming Interface, 응용 프로그램 프로그래밍 인터페이스)는 응용 프로그램에서 사용할 수 있도록, 운영 체제나 프로그래밍 언어가 제공하는 기능을 제어할 수 있게 만든 인터페이스를 뜻한다.”</i></span>

... 뭐라는거야 ? 라는 생각밖에 안들지만 앞서 말한거처럼 연결고리라고 생각하면 이해가 쉽다. 예를 들어, 우리가 식당에서 자주 볼 수 있는 키오스크를 생각해보자.

```
< 키오스크 이용 사례 >
1. 사용자는 키오스크를 이용해 물건을 선택한다.
2. 키오스크 내에서 결제 방법을 선택한다.
3. 신용카드, 현금 결제 등의 결제를 이용한다.
```

우리가 간편하게 이용할 수 있는 이러한 키오스크는 실제로는 여러 프로그램의 집합체이다. 사용자에게 보여지는 **키오스크 프로그램**, 키오스크에서 구매할 수 있는 물건의 정보들을 보관하고 있는 **데이터베이스**, 현금 결제 시에 **결제 정보를 관리**하는 프로그램, 신용 카드 결제 시에 사용되는 **카드사 프로그램** 등등, 우리에게 보여지는 건 키오스크 1개 이지만 그 업무를 수행하기 위해서는 관련된 다양한 프로그램이 사용되어야 한다. 이들을 사용할 수 있도록 연결해주는 것이 API 이다. 각 프로그램의 실제 코드를 정확히 알지 못하더라도 외부에서 이를 사용할 수 있도록 특정 규약에 기반해 요청자가 API 를 통해 요청을 보내면, 이에 맞는 프로그램의 동작 및 응답을 보내준다. 그렇기에 API 는 애플리케이션 개발에 있어 유연성과 시간/비용 절약에 필수적이다.



**REST** 란 Representational State Transfer 의 약자이다. 로이 필딩 (Roy Fielding) 에 의해 제안된 웹의 효율적 활용방안이자 HTTP 를 보다 효율적으로 활용할 수 있게 하는 소프트웨어 아키텍처의 한 종류이다. HTTP 통신을 십 분 활용해 웹 상에 존재하는 다양한 데이터에 고유한 URI 를 부여하고 HTTP Method 들을 이용해 CRUD ( Create, Read, Update, Delete ) 기능을 수행하게 하는 것이다.

> URI ? URL ?
>
> 우리는 흔히 URL 이란 단어를 특정 웹사이트의 주소 ( 브라우저에 입력하는 문자열 ) 로 알고 사용한다. 위 두 단어는 모두 인터넷 상의 데이터를 나타내기 위한 용어로서 약자를 통해 의미를 분석해보자.
>
> **URI : Uniform Resource Identifier [ 식별자 ]**
>
> **URL : Uniform Resource Locator [ 위치 ]**
>
> 단어 뜻으로 비추어보았을 때, 식별자인 URI 가 URL 보다 상위개념임을 알 수 있다. 이해를 돕기 위해 예를 들어보자면 우리가 CU 편의점에서 코카콜라를 산다고 했을 때, **'CU 편의점'이 URL** 이고 **'CU 편의점의 코카콜라'가 URI** 라고 생각하면된다. 즉, URI 는 URL 을 포함하며 보다 구체적인 정보를 나타낼 때는 URL 에서 추가된다고 생각하면 된다.
>
> ```
> URL , URI 한번에 비교하기 !
> 
> http://hubtwork.com : hubtwork 서버에 접속하는 URL 이면서 URI
> http://hubtwork.com/aboutme.md : hubtwork 서버의 aboutme.md 라는 자원의 위치를 의미하므로 URL 이면서 URI
> http://hubtwork.com/post?id=31 : hubtwork 서버의 'http://hubtwork.com/post' URL 의 '?id=31' 이라는 식별자를 추가해 원하는 정보를 얻는 것이므로 URI 이지만 URL 은 아님 
> ```



## 2. REST API 의 구성과 특징

---

REST API 는 3가지의 구성과 6가지의 특징만 기억하면 된다. 먼저 구성부터 살펴보자. 

- 자원  ( Resource ) : URI

  > REST 아키텍처 상에서 모든 웹의 자원은 식별가능한 고유 ID 값을 가지고 있으며, 클라이언트는 각 자원들의 상태를 조작 ( CRUD ) 하는 HTTP 요처을 서버에 전송한다. 예를 들어 hubtwork.com 이라는 API URL 에 대해 4번 글을 식별자로 나타낸다면 "/post/4" 와 같이 나타낼 수 있다.

- 행위 ( Verb ) : HTTP Method

  >REST 아키텍처 상에서 클라이언트는 앞서 말한 특정 자원에 대한 CRUD 작업을 수행하기 위해 아래와 같이 각 HTTP Method 를 활용한다. 
  >
  >C reate	-	Post ( 자원의 생성 )
  >
  >R ead	-	Get ( 자원의 조회 )
  >
  >U pdate	-	Put ( 자원의 갱신, 데이터 업데이트 )
  >
  >D elete	-	Delete ( 자원의 삭제 )

- 표현 ( Representation ) : JSON, XML, ... etc

  >클라이언트가 앞서 말한 각 행위를 통해 서버에 요청을 보낼 때, 서버가 응답으로 자원의 상태 및 표현을 전송한다. 그 예시로 JSON, XML 등 다양한 자원의 형태를 들 수 있다.



앞서 말한 개요와 구성을 살펴보았을 때, REST API 가 대충 어떤 건지는 이제 좀 알 것도 같다. 그럼 그 특징은 어떠한지 살펴보자.

1. 일관성 있는 인터페이스 ( Uniform Interface )

   >URI 로 지정된 자원에 대해 통일되고 한정적인 인터페이스로 행위를 수행한다. 이는 다른 말로 HTTP 표준만 따른다면, 모든 플랫폼에서 사용 가능한 크로스 플랫폼 ( Cross - Platform ) 의 특징을 띈다고 할 수 있다.

2. 클라이언트 - 서버 구조

   >REST API 는 API 를 제공하는 서버와 사용자 인증, 세션 등을 직접 관리하는 클라이언트 구조로 구분된다. 즉 간단히 말해 사용자가 자원을 요청하는 클라이언트와 자원을 소유 및 제공하는 서버로 엄격하게 구분되기 때문에 의존성이 줄어들고 독자적으로 개발할 수 있다. 이러한 특성은 개발 단계에 있어 효율성과 명확성을 증대시킨다.

3. 무상태성 ( Stateless )

   >REST API 의 근간인 HTTP 프로토콜은 기본적으로 무상태성 ( Stateless ) 를 지향한다. 그렇기에 REST API 또한 각 작업들에 대한 상태 정보를 따로 관리하지 않고, 단순히 클라이언트에 의한 요청에 대한 처리만 진행하면 된다. 서버 측면에서 불필요하게 클라이언트의 컨텍스트를 저장하는 등의 작업을 진행할 필요가 없기 때문에 제공하는 서비스의 자유도는 높아지고 구현이 쉬워진다.

4. 캐시 가능성 ( Cacheable )

   >앞서 무상태성과 같이 REST API 는 HTTP 프로토콜을 이용한다. 그렇기에 웹에서 기존에 사용하는 인프라는 모두 사용 가능하다. 대표적으로 캐싱 기능을 적용 가능하다는 것이 큰 특징이다. 일반적인 GET / POST 연산에 대해 캐싱이 가능하도록 할 수 있다. ( PUT, DELETE 요청은 브라우저 측면, 서버 측면 양쪽 모두에서 캐싱 기능을 적용할 수 없다.)

5. 자체 표현 구조 ( Self - Descriptiveness )

   >REST API 의 요청은 HTTP Method ( 행위 ) + URI ( 자원 ) 의 구조로 이루어져 있기 때문에 API 메세지만으로도 API 에 대한 이해를 쉽게 할 수 있다.

6. 계층 구조 

   >REST API 서버는 순수 비즈니스 로직만을 수행하게 작성하고 인증, 암호화, 로드밸런싱 등의 미들웨어를 계층적으로 추가해 유연한 구성을 할 수 있다. 



## 3. REST API 의 장단점

---

REST API 는 이처럼 순수하게 서비스 로직만에 집중할 수 있게 하고 한편으로는 사용자가 서비스를 이용하는 데에 편이하게 한다. 하지만 모든 것에는 장점과 단점이 존재한다. 장, 단점과 함께 어떤 상황에서 REST API 를 쓰면 좋을지 안좋을지를 알아보자.



### 장점

1. 클라이언트 - 서버의 명시적인 분리

   >클라이언트는 REST API 를 통해 서버와 필요한 때에, 정확한 자원에 대해 ( URI ) 필요한 행위 ( HTTP Method ) 만을 수행할 수 있다. 그렇기 때문에 서버는 Stateless 상태를 고수할 수 있고, 클라이언트의 컨텍스트 ( 세션 등 ) 을 유지할 필요가 없다. 만일, 특정 자원에 대한 접근과 같이 인증이 필요하다면 토큰 인증 방식 ( JWT, OAuth, OpenID 등 ) 으로 검증만 진행해주면 된다.

2. 원하는 데이터 표현이 가능함

   >REST API 의 구성은 3가지로 분류되어 있다 ( 자원, 행위, 표현 ). 이에 따라 서버와 통신할 때 원하는 자원 ( URI ) 에 대한 행위 ( HTTP Method ) 를 헤더에 명시하고, 표현 ( Body ) 에 동작에 필요한 데이터들을 담아 주고받는다. JSON, XML, Raw data 등 다양한 데이터의 표현이 가능하기 때문에 서버와 통신시에 원하는 서비스 플로우의 구현이 용이하다.

3. 쉽고 편리한 사용

   >REST API 는 HTTP 프로토콜의 인프라를 모두 적용하는 '아키텍처' 이다. 그렇기 때문에 서비스 제공자 입장에서는 별도의 인프라 구축 없이 간편하게 서버에 필요한 기능들을 이용하면 된다. 뿐만 아니라 API 에 대한 도큐멘트의 작성이 쉽고, 이로 인해 사용자 입장에서는 편리하게 서비스의 기능들을 이해하고 사용할 수 있다.



### 단점

1. 표준이 아닌 API 설계 방식

   >REST API 는 HTTP 프로토콜을 적용한 '아키텍처' 이지만 어떠한 표준이 아니다. 로이 필딩의 저서에 따르면 REST API 는 HTTP 를 보다 효율적으로 활용할 수 있는 하나의 방법론적 제시이기 때문에 명확한 표준은 존재하지 않고, 이렇게 하면 좋을 것이다라는 개념이다. 그러므로 REST API 개념을 준수한 RESTful 서버일지라도, REST 하다 라고 얘기할 수 있지만 REST 이다 라고 얘기할 수는 없다고 생각한다.

2. 제한적인 동작

   >HTTP Method 는 CRUD 동작과 매칭되는 데이터를 다루는 기본이 되는 4가지의 행위를 제공한다. 이는 쉬운 사용이 가능하게끔 한다는 장점이 있지만, 복합적인 동작등은 구현할 수 없다는 단점이 있다. 그렇기 때문에 서비스 로직 상에서 다양한 동작을 하는 서비스는 따로 두고, 사용자와 데이터에 대해 CRUD 동작을 진행할 수 있는 데이터들에 대해서만 REST API 서버를 두는 것이 좋다.



## 4. REST API 가이드라인

---

REST API 를 설계한다면, 무엇보다 중요시해야 하는 것이 있다. 이것이 지켜져야 비로소 REST 하다! 라고 할 수 있다고 생각하면 된다.

<span style="color:red"><b><i> " URI 는 특정 데이터의 자원을 표시해야 하며 그 자원에 대한 행위는 반드시 HTTP Method 로 명시해야 한다. " </i></b></span>

말로만 들으면 이게 정확히 무슨 말인가... 라는 생각이 들 수 있다. 특정 상점의 물품들에 대해 서비스하는 REST API 의 CRUD Operation 들을 예시로 살펴보자.

#### CREATE

```
GET /shops/{shop_id}/items/create/{item_id}			(x)		-	잘못된 HTTP Method
POST /shops/{shop_id}/items/{item_id}/					(x)		-	잘못된 URI 구분자
GET /getItem/shops/{shop_id}/items/{item_id}		(x)		- 잘못된 URI 표현

POST /shops/{shop_id}/items/{item_id}						(o)
```

위 3개의 요청은 잘못되었다...? 크게 보면 동작도 정의한 것 같고, URI 도 나름 만든 것 같아 별 문제 될 게 없어 보인다. 자세한 내용은 아래 설계 규칙 파트에서 다룰 것이고, 여기서 중요한 것은 맨 아래의 올바른 요청과 같이 **URI 는 데이터의 자원만을 표시하며 행위는 올바른 HTTP Method 에 매칭해야한다는 것이다.** 즉 URI 는 일련의 규칙에 맞게 데이터의 자원만을 표시할 수 있도록 하고, 동작에 대해서 올바른 HTTP Method 를 사용하게끔 해야한다는 것을 유념하자.

#### READ

```
GET /shops/{shop_id}/items/{item_id}						(o)
```

#### UPDATE

```
PUT /shops/{shop_id}/items/{item_id}						(o)
```

#### DELETE

```
DELETE /shops/{shop_id}/items/{item_id}					(o)
```



아래 표를 명심하며 URI 는 자원의 표현만을 명확히 하고, 각 자원에 대한 행위는 HTTP METHOD 를 통해 할 수 있도록 명시적으로 분리해 설계하도록 한다.

| CRUD                   | HTTP METHOD |
| ---------------------- | ----------- |
| CREATE ( 자원의 생성 ) | POST        |
| READ ( 자원의 조회 )   | GET         |
| UPDATE ( 자원의 갱신 ) | PUT         |
| DELETE ( 자원의 삭제 ) | DELETE      |



### REST API 설계

####   REST 설계 가이드

- URI 의 표현에는 소문자만을 사용하는 것이 좋다. 

  >URI 문법 표준인 RFC3986 에서는 호스트 정보와 URI 스키마 정보를 제외하고는 대소문자를 구분하도록 규정되어 있다. 그렇기 때문에 대소문자를 혼용하여 사용할 수 있도록 설계하게 되면 같은 리소스임에도 원치 않는 접근이 이루어질 수 있다. 가능하다면 소문자만을 사용해 자원의 인식을 보다 용이하게 하도록 하자.

- 밑줄(_) 은 금지! 가독성의 향상이 필요할 땐 하이픈(-) 을 사용하자 !

  >URI 가 길어지면 길어질수록 가독성은 떨어지게 된다. 이럴 때 만약 URI 내에 밑줄이 포함되어 있다면, 오히려 가독성이 떨어지는 결과를 야기할 수 있다. 불가피하게 가독성의 향상이 필요하다면 하이픈을 사용해서 눈에 띄는 구분자를 사용하도록 하자.

- URI 내의 계층관계는 슬래시(/) 를 이용해 구분한다.

  >URI 를 나타내는 모든 글자는 특정 자원을 나타내는 데에 쓰일 수 있어야 한다. 이 때, 자원을 표기하기 위한 관계를 나타내기 위해 슬래시 (/) 를 사용한다. 임의의 결제 API 를 URI 로 나타낸 아래의 예시를 보자.
  >
  >```
  >GET http://hubtwork.paymentapi.com/users/{user_id}/receipts/card
  >```
  >
  >결제내역 중 특정 {user_id} 에 대한 카드 결제 내역들을 조회하기 위한 URI 이다. 해당 유저의 영수증 중에 카드 내역, 즉 Has ( 소유관계 ) 에 대한 구분을 슬래시를 이용해 표현하였다. 이처럼 자원을 표현할 여러 항목들 간의 연관관계 ( 대표적으로 소유 관계 ) 를 나타내기 위해 슬래시를 이용한다. 말한 것처럼 URI 의 구분자로서 사용되기 때문에 명시적인 자원의 정보를 표기하기 위해 슬래시는 URI 의 마지막에는 사용하지 않도록 하자.

- 집합과 객체의 구분을 확실히 하자.

  >서버가 소유한 자원을 표현할 때는 단일 객체와 집합의 구분을 명시적으로 표현해주는 것이 좋다. 두가지 URI 를 예로 살펴보자.
  >
  >```
  >1. http://hubtwork.paymentapi.com/payments/card		(권장)
  >2. http://hubtwork.paymentapi.com/payment/card
  >```
  >
  >1번 예시의 경우 여러 개의 결제 수단 중 카드에 대해 접근한다는 것을 표현하는 데에 적합하며, 사용자 입장에서 해당 API 내에는 여러 종류의 결제수단이 존재한다는 것을 이해하기 쉽다. 하지만 2번 예시의 경우에는 복수명사를 이용한 집합의 표현이 결제수단이라는 정보에 적용되어 있지 않기 때문에 사용자 입장에서 명시적으로 자원 간의 관계를 이해하기가 쉽지 않다. 
  >
  >자원의 명확한 표현을 위해 집합 / 객체 의 표현을 단수 / 복수 단어로서 표현한다면 사용자 입장에서 보다 이해하기 쉬운 URI 를 작성할 수 있다.

- 요청에 대한 응답 시 작업의 상태 코드도 함께 반환하자. 

  >REST API 의 클라이언트로부터 전달된 요청에 대한 작업을 수행하기 위해 전달받은 데이터를 읽거나 혹은 작업을 진행하는 도중 해당 자원에 대해 정확히 명령이 수행되었는지, 혹은 어떠한 이유에 의해 작업이 정상적으로 수행될 수 없거나 수행되지 않았을 때에 대한 작업 상태 코드를 반환해주어야 비로소 잘 설계된 REST API 라고 할 수 있다. 보통은 HTTP 상태코드로 반환하지만 서비스의 도큐멘트를 사용자가 이해하기 쉽도록 잘 정리하였다면 임의의 상태코드를 작성하여 사용하는 것도 좋다.





### END

---

REST API 에 대해 공부하고 다양한 프로젝트에 적용하면서 내가 정말 RESTful 한 API 를 구현하고 있는 건가 ? 라는 생각이 자주 들었다. 이 글을 준비하면서 Roy Fielding 의 논문을 다시금 읽어보게 되었고 내가 잊고 있었던, 그리고 반드시 알아야 할 내용들을 되새기는 좋은 기회가 되었다. 현재 공부중에 있으며 추후 글로 다룰 단계별 REST 아키텍처 등 내가 알고 있던 것이 완전하지 않았다는 것을 알게 되었고 누구에게나 쉽게 설명할 수 있을 수준의 지식을 갖춰야 겠다는 마음가짐을 가질 수 있는 좋은 기회였다. 

이 글을 읽게 될 분들에게도 말씀드리고 싶다. 보다 RESTful 한 API 의 설계를 하심에 있어 제 글이 도움이 되었으면 좋겠고 요즘 마이크로 서비스의 유행과 함께 REST API 를 무조건적으로 사용하기보다는 개발하려는 서비스의 형태, 팀의 개발 성향 등을 고려해 아키텍처를 도입하여 사용자에게 보다 훌륭한 서비스를 제공하기를 바란다.



### REFERENCE

---

- http://haah.kr/2017/08/05/rest-series-summary/
- https://shoark7.github.io/programming/knowledge/what-is-rest
- https://sabarada.tistory.com/9
- https://renegades.tistory.com/entry/RESTful-API%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80

