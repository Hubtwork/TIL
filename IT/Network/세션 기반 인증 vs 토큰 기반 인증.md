### Session 기반 인증 vs Token 기반 인증



#### Session 기반 인증

- `세션 기반 인증` - 세션을 이용한 **Stateful** 인증 방식

- 서버에서 클라이언트 별로 세션을 만들고 유지하면서 정보를 저장 / 조회 함으로써 상태를 유지함

- **인증 Flow**

  - 클라이언트가 인증 요청시 서버는 세션을 만들고 클라이언트에게 `Session ID` 를 발급해 브라우저의 쿠키에 저장
  - 클라이언트는 서버에 요청 시에 `Session ID` 쿠키를 담아 요청
  - 요청을 받으면 서버는 `Session ID` 를 이용해 클라이언트의 세션을 식별하고 저장된 세션 정보를 불러와 서비스에 이용

- **단점**

  - 세션 유지 비용 & 낮은 확장성

    >  일반적으로 세션은 서버의 메모리에 저장하는데, 클라이언트의 연결 중에 세션을 지속적으로 유지해야하므로 **RAM에 큰 부하**를 초래한다. 이를 피하기 위해서 DB 를 활용하기도 하는데 **서비스의 규모가 커질수록 DB 커넥션 비용, 세션 유지 비용이 기하급수적으로 증가**한다.
    >
    >  또한 서비스의 확장 또는 트래픽 처리를 위해 여러 인스턴스를 띄우거나 서버를 추가했을 때 서로 다른 인스턴스끼리 세션을 공유하거나 세션을 분산 처리할 수 있는 시스템을 설계해야한다. 하지만 이는 **서비스를 확장하는 비용보다 세션 관리 시스템 설계 비용이 더 높아지는 문제를 초래**할 수 있다.

  - CORS ( Cross-Origin Resource Sharing )

    >  세션 기반 인증에서 클라이언트와 서버 간에 `Session ID` 를 주고받기 위해 사용되는 쿠키는 단일 도메인 혹은 서브 도메인에 한해 작동하도록 설계되어 있다. 이 때, **쿠키 사용시에 CORS 를 설정해야하는데 이는 애플리케이션의 규모가 커지면서 각 서비스들을 여러 도메인으로 확장 / 분할한다면 관리가 힘들어진다는 문제**가 있다.



#### Token 기반 인증

- `토큰 기반 인증` - 토큰을 이용한 **Stateless** 인증 방식

- 인증받은 사용자에 대해 토큰을 발급하고 이를 이용해 인증 정보를 주고받음으로써 요청에 대한 작업을 처리함

- **인증 Flow** 

  - 클라이언트가 인증 요청 시 서버는 `Signed 토큰` 을 발급해 클라이언트에 전달
  - 클라이언트는 서버에 요청 시에 헤더에 `Signed 토큰` 을 담아 요청
  - 요청을 받으면 서버는 토큰을 검증하고 토큰에 포함된 인증 정보를 서비스에 이용

- **장점** 

  - 확장성 ( Scalability & Extensibility )

    >  클라이언트와 서버간에 인증에 대한 의존성이 없기 때문에 서버 확장 시에 세션 기반 인증 방식보다 유리하다. 클라이언트가 어떤 서버에 접속하더라도, 한 인스턴스에서 **인증을 거쳐 토큰을 발행받아 유효성 검증이 가능하기만 하면 된다**. 이는 마이크로서비스 아키텍처, 클라우드 환경 등에서 단일 인증을 통한 서비스 이용을 가능하게 한다.
    >
    >  Scalability 와 다른 의미의 확장성 ( Extensibility ) 로서 **인증 정보를 외부 서비스에 공유할 수 있는 장점** 또한 가진다. 각 토큰에 선택적인 인증 정보 및 권한 만을 부여해 다른 서비스에 로그인 가능하게 할 수 있다. 대표적으로 Facebook, Google, Kakao 등 OAuth 를 이용한 소셜 로그인을 생각해볼 수 있다.

  - 보안

    >  세션 기반 인증의 경우 쿠키로 세션아이디를 전달하게되는데, 이는 공격자에 의해 탈취당할 시 해당 세션정보에 접근이 가능하게 하는 큰 위험을 초래할 수 있다. 토큰 기반 인증은 암호화된 토큰을 전달함으로서 인증서비스에 대한 이용을 가능하게 하므로 보다 높은 보안을 제공한다.

  - 다양한 플랫폼 및 도메인 사용

    >  애플리케이션과 서비스의 규모가 커지게 되면 다양한 디바이스에 호환될 수 있어야 한다. 또한 더 많은 서비스의 지원을 위해 여러 도메인을 사용하게 되는데, **토큰 기반 인증은 토큰 검증 방식만 일치한다면 인증을 진행**할 수 있다. 즉, 서버가 늘어나거나 다양한 기기에 대한 지원이 추가되어야 할 때 토큰 기반 인증은 토큰을 담아 전송하기만 하면 되기 때문에 쿠키에 비해 호환성 적용에 유리하다.
    >
    >  쿠키는 발행한 도메인에 대해서만 유효하기 때문에 `hubtwork.auth.com` 에서 인증을 진행해 쿠키가 발행된다면 `hubtwork.api.com` 에 대해서는 쿠키가 유효하지 않다. 하지만 **서버의 응답에서 아래 헤더를 포함시키고 JWT 와 같은 토큰을 발행해 요청한다면 서로 다른 도메인에서도 유효한 토큰에 대해서 처리**할 수 있다.
    >
    > ~~~Http
    > Access-Control-Allow-Origin: *
    > ~~~



### REFERENCE

- http://stackoverflow.com/questions/1592534/what-is-token-based-authentication
- http://orca.st.usm.edu/~seyfarth/network_pgm/net-6-3-3.html
- https://velopert.com/2350
- https://d2.naver.com/helloworld/206816

