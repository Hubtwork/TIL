### What Is DNS ? 



#### DNS 란 무엇인가

- **Domain Name System** - 네트워크 상에서 <u>호스트의 IP 주소</u> 와 <u>도메인 이름</u> 간의 변환을 수행하는 시스템
- 각 서버는 통신을 위해 식별자인 **IP 주소** 를 사용하는데, 이를 'www.naver.com' 와 같이 사람이 읽기 쉬운 도메인으로 바꿔주는 **Service**
- 인터넷이 발전함에 따라 **호스트 수의 증가** 에 따라 이를 효율적으로 처리하기 위해 **분산형 데이터베이스 구조** 를 채택



#### DNS 의 구조

- **Domain Name Space**
  - DNS 가 분산 네이밍 시스템 상에서 저장 / 관리 하는 계층 구조의 데이터베이스
  - 최상위의 Root 부터 호스트가 트리구조로 연결되어 구성됨
  - *Root Host* 는 **Null Label** , 즉 0 바이트의 호스트
  - 그외의 *Host* 는 **최대 63 바이트의 Label** 로 이루어짐
  - 도메인은 **Bottom - UP** 방식으로 연결되어 하나를 이룸
- **Domain Name Server**
  - Domain Label 을 IP 주소로 변환시키기 위해 도메인 네임 스페이스의 트리 정보를 가지고 있는 서버
  - **Root Domain Name Server** 는 현재 전세계에 총 13개가 운영중 ( 미국 : 10, 일본 : 1, 네덜란드 : 1, 노르웨이 : 1 )
  - **[ 궁금증 ]** 그렇다면 우리나라의 Domain Name Server 는 ?
    - 국내의 경우 **SKT / KT / LG U+ / CJ HelloVision** , 이렇게 총 4대의 미러서버가 운영중
    - 국내 서버들의 경우 국내 대상 인터넷 서비스이므로 속도는 매우 빠름
    - **IPv6** 및 **DNS over HTTPS / TLS ** 와 같은 보안 기능을 지원하지 않음

- **Resolver**
  - DNS 클라이언트와 네임 서버 사이에서 요청과 응답을 처리하는 **중개자 역할** 수행
  - **수행 방식** : 클라이언의 응답을 받아 네임서버에 전달, 해당 정보가 존재하지 않을 경우 다른 네임서버에 전달
  - **기존의 단점** : 수많은 클라이언트들이 요청을 보내고 첫 네임서버에서 도메인을 찾지 못했을 경우, 다른 네임서버에 요청을 하게되면서 처리지연의 문제가 발생하며 이러한 Case 가 반복될 수록 요청에 대한 응답이 지연됨
  - **개선** : 클라이언트 측에 **Stub Resolver** 를 두어 해당 Resolver 가 구현된 네임 서버를 파악하여 빠르게 작업할 수 있도록 분산 / 경량화



#### DNS 의 Work Flow

- **일반적으로 Using UDP** : TCP 의 경우 Handshaking 과정과 같이 통신의 신뢰성 확보를 위한 과정이 수반됨. UDP 는 신뢰성보다는 데이터의 발송에 치중하였기 때문에 이와 같은 오버헤드가 발생하지 않고 고속의 통신이 가능하게 함
- **이럴땐 Using TCP** : UDP 의 경우 **패킷의 크기가 512 Byte** 를 넘을 수 없는데 이 떄 TCP 프로토콜을 이용해 재요청함. 또한 **Master-Slave** 구조를 이용해 <u>Zone 을 관리하는 다수의 DNS 서버</u> 를 이용할 경우 안정성이 떨어지게 되는데 신뢰성 / 안정성 측면에서 이를 관리하기 위해 **TCP 프로토콜** 을 이용하기도 함
- **Work Flow**
  - 유저가 브라우저를 이용해 특정 **도메인** 에 접근 요청
  - 미리 탑재된 **Local DNS** 에 대해 해당 도메인 탐색 요청 
    - **요청 도메인** 이 만약 캐시데이터에 존재할 시 **Local DNS** 에서 바로 응답
  - **Root DNS** 네임 서버에 도메인 탐색 요청
  - **Local DNS** 가 도메인에 포함된 서브도메인을 관리하는 **DNS 네임 서버** 에 탐색 요청
  - 해당 네임 서버가 요청의 도메인을 관리하는 **DNS 네임 서버** 를 알려주고 **Local DNS** 가 확인 후 해당 네임서버에 요청
  - 탐색 대상 도메인을 관리하는 **DNS 네임 서버** 가 네임스페이스에 저장된 도메인을 비교 / 확인 후 해당하는 **Endpoint IP 주소** 를 응답
  - **Local DNS** 는 해당 IP주소를 캐싱한 후 **IP 주소** 응답



### REFERENCE

- https://docs.microsoft.com/ko-kr/troubleshoot/windows-server/networking/dns-works-on-tcp-and-udp

